*Please note that my contributions are attributed to my previous institutional RWTH email, though the repository is now hosted through my personal account.*

# PhoKiMo

PhoKiMo is a general kinetic model based on rate law. By utilizing given mechanism on toml file, you can calculate the kinetic scheme of the reaction. This model is using calculation result of `terachem`.

## Prerequisites

Directory from the calculation path should look like the structure below. Numbering does not matter, but folder name should **ENDS** with the `folder_name` at the toml file.

```
calculation_path/
├── 0000_aaa/
│   └── sp/
│       └── tc.out
├── 0001_bbb/
│   ├── sp/
│   │   └── tc.out
│   └── ground_sp/
│       └── tc.out
└── 0002_ccc/
    └── sp/
        └── tc.out
```

## Code structure and functions

`__main__.py`: main function of the kinetic model

`src/toml_reader.py`: reads and analyze the data based on toml

`src/io/terachem.py`: terachem data extraction 

`src/rate_constants.py`: rate constant calculation

`src/terachem_values.py`: using the data from terachem, calculate energy and rate constants

`ode_builder.py`: solving differential equation to get the concentration

`additional_functions`: additional analysis functions including exponential fitting, fractions, and output `phokimo.toml` generation

`mechanism/__main__.py`: main function of the mechanism diagram generation

Detailed explanations of the functions can be found at the docstring.

## How to run the kinetic model

Kinetic model should be run on the cluster that has terachem output file.

```
python3 -m phokimo input.toml
```

### Inputs

`input.toml`: toml file that includes information of the target mechanism

### Outputs

`phokimo.toml`: toml file of output values including energy, rate constants, time constants, and fractions

`phokimo_state_energy.png`: plotted energy of each state (eV)

`phokimo_kinetics_state.png`: concentration vs. time of each state

`phokimo_kinetics_spin.png`: concentration vs. time of each spin

`phokimo_expfitting.png`: exponential fitting curve on concentration vs. time of each spin


## How to draw the mechanism diagram

Drawing mechanism on the cluster is not supported, so it should be run independently on your local environment with the same toml file previously.

```
python3 -m phokimo.mechanism input.toml
```

### Inputs

`input.toml`: toml file that includes information of the target mechanism

### Outputs

`mechanism_diagram.png`: mechanism graph diagram generated by graphviz

## Some limitations and features to add
- Overall, no reaction among multiple spin states (including triplet) have been tested
- Only conical intersections are supported, current format does not supports crossing point
- Dissociation is only supported at the last step as substate form
